class ProductCardRendererRVP{constructor(t,e){this.settings=t,this.widgetSettings=e,this.template=document.getElementById("product-card-template")}createCard(t){const e=this.template.content.cloneNode(!0),i=e.querySelector(".recently-viewed-card"),r=t.variants[0].presentmentPrice,n=t.variants[0].presentmentCompareAtPrice,s=t.ratingCount;return this.setupCardLayout(i),this.setupProductData(i,t),this.setupPriceElements(i,r,n),this.setupRatingElements(i,t.rating,s),this.setupVariantInput(i,t),this.setupButtonHandlers(i,t),e}setupCardLayout(t){t&&(t.setAttribute("data-card-layout",this.settings.cardLayout),"horizontal"===this.settings.cardLayout?t.classList.add("recently-viewed-card--horizontal"):t.classList.remove("recently-viewed-card--horizontal"),t.style.setProperty("--show-add-to-cart",this.settings.showAddToCart?"block":"none"),t.style.setProperty("--show-buy-now",this.settings.showBuyNow?"block":"none"))}setupProductData(t,e){const i=t.querySelector(".recently-viewed-image-link"),r=t.querySelector(".recently-viewed-title"),n=t.querySelector(".recently-viewed-image"),s=t.querySelector(".recently-viewed-reviews-link");i&&(i.href=e.url),r&&(r.href=e.url),n&&(n.src=e.image||""),r&&(r.textContent=e.title||""),s&&(s.href=e.url);const a=t.querySelector(".recently-viewed-atc-button");if(a){const t=window.RecentlyViewedUtils.extractNumericId(e.id);a.setAttribute("data-product-card-swatch-id",t),a.href=e.url}const l=t.querySelector(".recently-viewed-buy-now-button");if(l){const t=window.RecentlyViewedUtils.extractNumericId(e.id);l.setAttribute("data-product-card-swatch-id",t),l.href=e.url}const o=t.querySelectorAll(".quick-view-btn"),c=e.variants&&e.variants.length>1||e.variants&&1===e.variants.length&&"Default Title"!==e.variants[0].title;o.forEach((t=>{t.setAttribute("data-product",JSON.stringify(e)),t.setAttribute("data-title",encodeURIComponent(e.title)),t.setAttribute("data-has-variants",c?"true":"false")}));if(!e.variants?.some((t=>t.availableForSale))){const e=t.querySelector(".recently-viewed-atc-button"),i=t.querySelector(".recently-viewed-buy-now-button");if(e){const t=e.querySelector(".recently-viewed-atc-button-text");t&&(t.textContent="Sold Out"),e.disabled=!0,e.style.opacity="0.5",e.style.pointerEvents="none"}if(i){const t=e.querySelector(".recently-viewed-buy-now-button-text");t&&(t.textContent="Sold Out"),i.disabled=!0,i.style.opacity="0.5",i.style.pointerEvents="none"}}}setupPriceElements(t,e,i){const r=t.querySelector(".recently-viewed-price"),n=t.querySelector(".recently-viewed-compare-price"),s=t.querySelector(".recently-viewed-badge");if(r){const t=parseFloat(e).toFixed(2),i=String(t);r.textContent=window.CurrencyUtils.formatMoneyCurrency(i,window.money_format)}if(n){if(parseFloat(i||0)>parseFloat(e||0)){const t=parseFloat(i).toFixed(2),e=String(t);n.textContent=window.CurrencyUtils.formatMoneyCurrency(e,window.money_format),n.style.display="inline"}else n.style.display="none"}if(s){const t=parseFloat(i),r=parseFloat(e),n=Math.round((t-r)/t*100);if(!isNaN(n)&&n>0){const t=(this.widgetSettings.saveText||"Save {percent}%").split("{percent}");let e=t[1]||"",i="";e.startsWith("%")&&(i="%",e=e.slice(1)),s.innerHTML=`${t[0]}<div class="recently-viewed-discount-value">${n}${i}</div>${e}`,s.style.display="flex",s.style.flexDirection="row",s.style.whiteSpace="pre"}else s.style.display="none"}}setupRatingElements(t,e,i){const r=t.querySelector(".recently-viewed-stars"),n=t.querySelector(".recently-viewed-review-count");if(r&&e>0){r.style.setProperty("--rating",e),r.parentElement.classList.add("visible"),r.parentElement.style.visibility="visible";const t=(this.widgetSettings.starsText||"{count} review/reviews").replace("{count}",i);n&&(n.textContent=t)}else r&&(r.parentElement.style.visibility="hidden",r.parentElement.classList.remove("visible"))}setupVariantInput(t,e){const i=t.querySelector(".product-variant-id"),r=t.querySelector(".recently-viewed-form"),n=t.querySelector(".recently-viewed-buy-now-form");if(i)if(e.variants?.length>0&&e.variants[0].id){const t=e.variants[0].id.split("/").pop();if(i.value=t,r&&(r.setAttribute("data-product-title",e.title),r.setAttribute("data-variant-id",t)),n){n.querySelector(".product-variant-id").value=t,n.setAttribute("data-product-title",e.title),n.setAttribute("data-variant-id",t)}}else this.disableUnavailableButtons(r,n)}disableUnavailableButtons(t,e){if(t){t.style.opacity="0.5",t.style.pointerEvents="none";const e=t.querySelector("button");e&&(e.disabled=!0,e.textContent="Unavailable")}if(e){e.style.opacity="0.5",e.style.pointerEvents="none";const t=e.querySelector("button");t&&(t.disabled=!0,t.textContent="Unavailable")}}setupButtonHandlers(t,e){t.querySelector(".recently-viewed-form"),t.querySelector(".recently-viewed-buy-now-form")}}class CarouselControllerRVP{constructor(t,e,i,r){this.carousel=t,this.prevBtn=e,this.nextBtn=i,this.cardLayout=r,this.currentIndex=0,this.cards=[],this.gap=20,this.resizeObserver=new ResizeObserver((()=>this.handleResize()))}init(){if(this.cards=Array.from(this.carousel.querySelectorAll(".recently-viewed-card")),0===this.cards.length)return;this.cardWidth=this.cards[0].getBoundingClientRect().width,this.containerWidth=this.carousel.parentElement.getBoundingClientRect().width;const t=window.getComputedStyle(this.carousel).gap;this.gap=t?parseFloat(t):20,this.maxIndex=this.calculateMaxIndex(),this.prevBtn.addEventListener("click",this.prevHandler=()=>this.navigate(-1)),this.nextBtn.addEventListener("click",this.nextHandler=()=>this.navigate(1)),this.resizeObserver.observe(this.carousel.parentElement),this.updateCarousel()}calculateMaxIndex(){const t=this.cardWidth+this.gap,e=Math.max(1,Math.floor((this.containerWidth+this.gap-1)/t));return Math.max(0,this.cards.length-e)}navigate(t){this.currentIndex=Math.max(0,Math.min(this.currentIndex+t,this.maxIndex)),this.updateCarousel()}updateCarousel(){this.currentIndex=Math.max(0,Math.min(this.currentIndex,this.maxIndex));const t=-this.currentIndex*(this.cardWidth+this.gap);this.carousel.style.transform=`translateX(${t}px)`,this.nextBtn.style.display=this.currentIndex>=this.maxIndex?"none":"flex",this.prevBtn.style.display=this.currentIndex<=0?"none":"flex"}handleResize(){this.cardWidth=this.cards[0]?.getBoundingClientRect().width||this.cardWidth,this.containerWidth=this.carousel.parentElement.getBoundingClientRect().width;const t=window.getComputedStyle(this.carousel).gap;this.gap=t?parseFloat(t):this.gap,this.maxIndex=this.calculateMaxIndex(),this.currentIndex=Math.min(this.currentIndex,this.maxIndex),this.updateCarousel()}destroy(){this.resizeObserver.disconnect(),this.prevBtn.removeEventListener("click",this.prevHandler),this.nextBtn.removeEventListener("click",this.nextHandler)}}